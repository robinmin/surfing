# Task ID: 13
# Title: Implement Multi-Environment URL Configuration
# Status: pending
# Dependencies: 12
# Priority: medium
# Description: Configure authentication to work across local, preview, and production environments
# Details:
Configure Supabase with: 1) Primary Site URL set to production domain (https://surfing.salty.vip), 2) Wildcard patterns for preview environments (http://localhost:4321/**, https://*.pages.dev/**, https://surfing.salty.vip/**), 3) Update OAuth provider settings to include all environment URLs, 4) Ensure environment variables are correctly set in all deployment contexts.

# Test Strategy:
Test authentication flow in local development, Cloudflare preview deployments, and production environment

# Subtasks:
## 1. Configure Supabase Project Authentication URLs [pending]
### Dependencies: None
### Description: Set up Supabase project authentication configuration for multi-environment support
### Details:
Access Supabase dashboard > Authentication > URL configuration. Set Primary Site URL to https://surfing.salty.vip. Add redirect URLs for all environments: http://localhost:4321/**, https://*.pages.dev/**, https://surfing.salty.vip/**. Configure wildcard patterns to support preview environments and localhost development. Ensure OAuth provider callback URLs are updated to include all environment URLs.

## 2. Update Environment Variable Configuration Files [pending]
### Dependencies: 13.1
### Description: Ensure environment variables are properly configured for different deployment contexts
### Details:
Update .env.example with comprehensive environment-specific documentation. Verify that PUBLIC_SUPABASE_URL and PUBLIC_SUPABASE_ANON_KEY are correctly referenced in src/lib/supabase.ts. Ensure environment variables work correctly in Astro's import.meta.env context for both development and production builds. Document deployment-specific variable setup for Cloudflare Pages and local development.

## 3. Configure OAuth Provider Settings for Multi-Environment [pending]
### Dependencies: 13.1
### Description: Update Google OAuth and Apple Sign In configurations to support all deployment environments
### Details:
Update Google Cloud Console OAuth 2.0 Client ID configuration to include authorized redirect URIs for all environments: http://localhost:4321/auth/callback, https://*.pages.dev/auth/callback, https://surfing.salty.vip/auth/callback. Configure Apple Developer Portal Services ID with return URLs for all environments. Update PUBLIC_GOOGLE_CLIENT_ID and PUBLIC_APPLE_SERVICES_ID environment variables. Ensure callback URLs match across Supabase and OAuth provider configurations.

## 4. Implement Environment Detection and Configuration Logic [pending]
### Dependencies: 13.2
### Description: Add runtime environment detection to handle environment-specific authentication behavior
### Details:
Create src/utils/environment.ts utility to detect current environment (localhost, preview, production) based on window.location or import.meta.env. Update src/lib/supabase.ts to include environment-aware configuration options. Add dynamic redirect URL construction based on current environment. Implement environment-specific error handling and logging for authentication flows. Consider preview environment domain patterns for *.pages.dev detection.

## 5. Validate and Test Multi-Environment Authentication Flow [pending]
### Dependencies: 13.3, 13.4
### Description: Comprehensive testing and validation of authentication across all environments
### Details:
Perform end-to-end authentication testing in local development (localhost:4321), Cloudflare preview deployments (*.pages.dev), and production (surfing.salty.vip). Test Google One Tap, OAuth flows, and session persistence across environments. Verify proper session storage, token refresh, and authentication state management. Test error scenarios including network failures, invalid tokens, and environment configuration issues. Document any environment-specific authentication behaviors or limitations.

