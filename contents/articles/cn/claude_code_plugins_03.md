---
title: "ä¸ä»…ä»…æ˜¯ä»£ç åŠ©æ‰‹ï¼šç”¨ Plugins å°† Claude Code æ‰“é€ æˆä½ çš„ä¸“å±ç ”å‘ç»ˆç«¯"
description: "> **ç³»åˆ—å›é¡¾**ï¼šå‰ä¸¤ç¯‡æˆ‘ä»¬æŒæ¡äº† Plugins çš„æ ¸å¿ƒæ¦‚å¿µå’Œå®æˆ˜å¼€å‘æŠ€èƒ½ã€‚æœ¬ç¯‡å°†æ·±å…¥ä¼ä¸šçº§åº”ç”¨åœºæ™¯ï¼Œæ¢è®¨å¦‚ä½•åœ¨ä¿éšœå®‰å…¨çš„å‰æä¸‹ï¼Œå°† Plugins èå…¥çœŸå®çš„ç ”å‘å·¥ä½œæµã€‚"
tags: ["javascript", "typescript", "angular", "python", "ai"]
readingTime: 11
wordCount: 2049
publishDate: 2025-10-13
draft: false
featured: false
---

# ä¸ä»…ä»…æ˜¯ä»£ç åŠ©æ‰‹ï¼šç”¨ Plugins å°† Claude Code æ‰“é€ æˆä½ çš„ä¸“å±ç ”å‘ç»ˆç«¯

## ç¬¬ä¸‰ç¯‡ï¼šåº”ç”¨ç¯‡ - ä¼ä¸šçº§åœºæ™¯ä¸å®‰å…¨å®è·µ

> **ç³»åˆ—å›é¡¾**ï¼šå‰ä¸¤ç¯‡æˆ‘ä»¬æŒæ¡äº† Plugins çš„æ ¸å¿ƒæ¦‚å¿µå’Œå®æˆ˜å¼€å‘æŠ€èƒ½ã€‚æœ¬ç¯‡å°†æ·±å…¥ä¼ä¸šçº§åº”ç”¨åœºæ™¯ï¼Œæ¢è®¨å¦‚ä½•åœ¨ä¿éšœå®‰å…¨çš„å‰æä¸‹ï¼Œå°† Plugins èå…¥çœŸå®çš„ç ”å‘å·¥ä½œæµã€‚

---

## ä¸€ã€ä¼ä¸šåº”ç”¨åœºæ™¯æ¦‚è§ˆ

### 1.1 åº”ç”¨åœºæ™¯çŸ©é˜µ

åœ¨æ·±å…¥å…·ä½“åœºæ™¯å‰ï¼Œè®©æˆ‘ä»¬å…ˆå»ºç«‹ä¸€ä¸ªå…¨æ™¯è§†å›¾ï¼š

```mermaid
mindmap
  root((Claude Code<br/>Plugins<br/>ä¼ä¸šåº”ç”¨))
    å¼€å‘æ•ˆç‡
      ä»£ç æœç´¢ä¸ç†è§£
      è‡ªåŠ¨åŒ–ä»£ç å®¡æŸ¥
      æ™ºèƒ½é‡æ„å»ºè®®
    è¿ç»´ç›‘æ§
      æ—¥å¿—å¿«é€ŸæŸ¥è¯¢
      æ€§èƒ½æŒ‡æ ‡åˆ†æ
      æ•…éšœæ ¹å› å®šä½
    é¡¹ç›®åä½œ
      å·¥å•ç®¡ç†é›†æˆ
      æ–‡æ¡£è‡ªåŠ¨åŒæ­¥
      å›¢é˜Ÿé€šçŸ¥æ¨é€
    æ•°æ®æ´å¯Ÿ
      å®‰å…¨æ•°æ®åº“æŸ¥è¯¢
      æŠ¥è¡¨è‡ªåŠ¨ç”Ÿæˆ
      ä¸šåŠ¡æŒ‡æ ‡åˆ†æ
    DevOps
      CI/CD è§¦å‘ç®¡ç†
      éƒ¨ç½²çŠ¶æ€æŸ¥è¯¢
      ç¯å¢ƒé…ç½®éªŒè¯
```

### 1.2 åœºæ™¯é€‰æ‹©æ ‡å‡†

å¹¶éæ‰€æœ‰ä»»åŠ¡éƒ½é€‚åˆæ’ä»¶åŒ–ã€‚è¯„ä¼°ä¸€ä¸ªåœºæ™¯æ˜¯å¦é€‚åˆæ—¶ï¼Œè€ƒè™‘ä»¥ä¸‹ç»´åº¦ï¼š

| è¯„ä¼°ç»´åº¦     | é«˜é€‚é…åº¦ç‰¹å¾     | ä½é€‚é…åº¦ç‰¹å¾     |
| ------------ | ---------------- | ---------------- |
| **é¢‘ç‡**     | æ¯å¤© 3+ æ¬¡       | æ¯æœˆ < 1 æ¬¡      |
| **å·¥å…·åˆ‡æ¢** | éœ€è¦ 2+ ä¸ªç³»ç»Ÿ   | å•ä¸€ç³»ç»Ÿå†…å®Œæˆ   |
| **æ ‡å‡†åŒ–**   | æµç¨‹å›ºå®šæ˜ç¡®     | é«˜åº¦åˆ›é€ æ€§ä»»åŠ¡   |
| **æ•°æ®å®‰å…¨** | å¯æ§çš„æƒé™èŒƒå›´   | æ¶‰åŠé«˜åº¦æ•æ„Ÿæ•°æ® |
| **ROI**      | èŠ‚çœ 10+ åˆ†é’Ÿ/æ¬¡ | èŠ‚çœ < 2 åˆ†é’Ÿ/æ¬¡ |

**å¿«é€Ÿåˆ¤æ–­å…¬å¼**ï¼š

```
æ’ä»¶åŒ–ä»·å€¼ = (èŠ‚çœæ—¶é—´ Ã— ä½¿ç”¨é¢‘ç‡ Ã— å›¢é˜Ÿäººæ•°) / å¼€å‘ç»´æŠ¤æˆæœ¬

å¦‚æœç»“æœ > 3ï¼Œå€¼å¾—æŠ•å…¥
```

---

## äºŒã€åœºæ™¯ä¸€ï¼šç§æœ‰ä»£ç åº“çš„"æ´»å­—å…¸"

### 2.1 ä¸šåŠ¡ç—›ç‚¹

**å…¸å‹åœºæ™¯**ï¼š

```
æ–°äººå°æå…¥èŒç¬¬äºŒå¤©ï¼š

å°æ: "è¿™ä¸ª UserService ç±»åœ¨å“ªä¸ªåŒ…é‡Œï¼Ÿ"
è€å‘˜å·¥: "åœ¨ core.services.user ä¸‹ï¼Œä½†å®é™…å®ç°åœ¨ impl å­åŒ…"

å°æ: "æ”¯ä»˜å›è°ƒæ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿ"
è€å‘˜å·¥: "æœ 'webhook' å…³é”®å­—ï¼Œæœ‰ä¸‰ä¸ªåœ°æ–¹ï¼Œä½ è¦çœ‹çš„æ˜¯ payment ç›®å½•ä¸‹é‚£ä¸ª"

å°æ: "è°æœ€è¿‘ä¿®æ”¹è¿‡è®¤è¯é€»è¾‘ï¼Ÿ"
è€å‘˜å·¥: "ç”¨ git blameï¼Œä½†è¦å°å¿ƒï¼Œæœ‰äº›æ˜¯é‡æ„æ—¶æ‰¹é‡æ”¹çš„..."

[30 åˆ†é’Ÿå...]
å°æ: æ„Ÿè§‰åƒåœ¨ä»£ç è¿·å®«é‡Œè¿·è·¯äº† ğŸ˜µ
```

**æ•°æ®ç»Ÿè®¡**ï¼š

- æ–°äººå¹³å‡éœ€è¦ **2 å‘¨**æ‰èƒ½ç†Ÿæ‚‰ä»£ç åº“ç»“æ„
- æ¯å¤©æµªè´¹ **1.5 å°æ—¶**åœ¨"æ‰¾ä»£ç "ä¸Š
- ä»£ç æœç´¢å  IDE ä½¿ç”¨æ—¶é—´çš„ **23%**

### 2.2 æ’ä»¶è§£å†³æ–¹æ¡ˆ

#### æ¶æ„è®¾è®¡

```mermaid
graph LR
    A[å¼€å‘è€…è‡ªç„¶è¯­è¨€æŸ¥è¯¢] --> B[Claude Code]
    B --> C[gitlab_search_plugin]
    C --> D[GitLab API]
    D --> E[ä¼ä¸š GitLab å®ä¾‹]

    C --> F[è¯­ä¹‰è§£æå±‚]
    F --> G[ä»£ç ç´¢å¼•ç¼“å­˜]

    E --> H[æœç´¢ç»“æœ]
    H --> I[æ ¼å¼åŒ–å±•ç¤º]
    I --> B

    style C fill:#e1f5ff
    style F fill:#fff3e0
```

#### æ ¸å¿ƒåŠŸèƒ½å®ç°

**OpenAPI è§„èŒƒç‰‡æ®µ**ï¼š

```yaml
openapi: 3.0.1
info:
  title: Internal GitLab Search Plugin
  version: 1.0.0

servers:
  - url: https://gitlab.company.com/api/v4

paths:
  /search:
    get:
      summary: Search across repositories
      operationId: searchCode
      parameters:
        - name: scope
          in: query
          required: true
          schema:
            type: string
            enum: [blobs, commits, projects, users]

        - name: search
          in: query
          required: true
          description: Search query
          schema:
            type: string

        - name: project_id
          in: query
          description: Limit to specific project
          schema:
            type: integer

      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    filename:
                      type: string
                    path:
                      type: string
                    project_id:
                      type: integer
                    ref:
                      type: string
                    data:
                      type: string
                      description: Code snippet with matches
```

**å¢å¼ºè¯­ä¹‰ç†è§£çš„ Prompt**ï¼š

````markdown
---
name: search-code
description: Search company codebase with natural language
---

# Internal Code Search

When user asks to find code, follow these steps:

## 1. Parse Intent

Identify what the user is looking for:

- **Class/Interface**: "UserService class" â†’ search for `class UserService`
- **Function/Method**: "JWT sign method" â†’ search for `jwt.sign` or `def sign_jwt`
- **Pattern**: "authentication logic" â†’ search for `auth`, `login`, `authenticate`
- **File**: "payment webhook handler" â†’ search in `payment` path for `webhook`

## 2. Construct Query

Build GitLab API query:

- Use `scope=blobs` for code content search
- Add project filter if mentioned
- Include file type hints (`.py`, `.js`, etc.)

## 3. Execute Search

```bash
curl "https://gitlab.company.com/api/v4/search?scope=blobs&search=<query>"
```
````

## 4. Format Results

Present top 5 results with:

- File path (clickable)
- Code snippet with context (5 lines before/after)
- Last modified date and author
- Relevance explanation

Example output:

````
Found 3 occurrences of "UserService":

1. **core/services/user/impl/user_service.py** (Line 42)
   ```python
   class UserService:
       def __init__(self, db_session):
           self.db = db_session
````

Last modified: 2025-10-05 by @alice
Context: Main user service implementation

2. **tests/unit/test_user_service.py** (Line 18)
   ...

```

```

### 2.3 å®é™…ä½¿ç”¨ç¤ºä¾‹

**ç¤ºä¾‹ 1ï¼šæŸ¥æ‰¾ç±»å®šä¹‰**

````
ğŸ‘¤ User: "æ‰¾å‡º user-authentication-service é¡¹ç›®ä¸­æ‰€æœ‰è°ƒç”¨äº† jwt.sign æ–¹æ³•çš„åœ°æ–¹"

ğŸ¤– Claude Code:
[è°ƒç”¨ gitlab_search_plugin]
æœç´¢å‚æ•°ï¼š
- scope: blobs
- search: jwt.sign
- project_id: 42 (user-authentication-service)

æ‰¾åˆ° 5 å¤„è°ƒç”¨ï¼š

1. **src/auth/token.js** (Line 42)
   ```javascript
   const token = jwt.sign(payload, SECRET_KEY, {
     expiresIn: '1h',
     issuer: 'auth-service'
   });
````

ğŸ“… 2025-10-05 | ğŸ‘¤ @alice | ğŸ’¬ feat: add token expiration

2. **src/middleware/refresh.js** (Line 28)
   ```javascript
   const refreshToken = jwt.sign({ userId: user.id, type: 'refresh' }, REFRESH_SECRET, { expiresIn: '7d' });
   ```
   ğŸ“… 2025-09-28 | ğŸ‘¤ @bob | ğŸ’¬ feat: implement refresh token

[æ˜¾ç¤ºæ›´å¤šç»“æœ...]

```

**ç¤ºä¾‹ 2ï¼šç†è§£å¤æ‚é€»è¾‘**

```

ğŸ‘¤ User: "æ”¯ä»˜å›è°ƒçš„å®Œæ•´å¤„ç†æµç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ"

ğŸ¤– Claude Code:
[å¤šæ­¥æœç´¢ç­–ç•¥]

Step 1: æœç´¢å…¥å£ç‚¹
â†’ æ‰¾åˆ° `POST /webhook/payment` è·¯ç”±

Step 2: è¿½è¸ªå¤„ç†å™¨
â†’ PaymentWebhookHandler.process()

Step 3: å…³è”ä¾èµ–
â†’ éªŒè¯ç­¾å â†’ è§£ææ•°æ® â†’ æ›´æ–°è®¢å• â†’ å‘é€é€šçŸ¥

å®Œæ•´æµç¨‹å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æ¥æ”¶ Webhook â”‚
â”‚ src/api/webhook/payment.py:15 â”‚
â”‚ @app.post('/webhook/payment') â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. éªŒè¯ç­¾å â”‚
â”‚ src/services/payment/verifier.py:32 â”‚
â”‚ verify_stripe_signature() â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. è§£æäº‹ä»¶ â”‚
â”‚ src/services/payment/parser.py:18 â”‚
â”‚ parse_webhook_event() â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. æ›´æ–°è®¢å•çŠ¶æ€ â”‚
â”‚ src/services/order/updater.py:45 â”‚
â”‚ update_order_status() â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. å‘é€ç”¨æˆ·é€šçŸ¥ â”‚
â”‚ src/services/notification/email.py:28â”‚
â”‚ send_payment_confirmation() â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ’¡ å…³é”®æ–‡ä»¶ï¼š

- å…¥å£ï¼šsrc/api/webhook/payment.py
- æ ¸å¿ƒé€»è¾‘ï¼šsrc/services/payment/handler.py
- æµ‹è¯•ï¼štests/integration/test_payment_webhook.py

```

### 2.4 ä»·å€¼é‡åŒ–

**æ•ˆç‡æå‡**ï¼š
- ä»£ç å®šä½æ—¶é—´ï¼šä» **5-10 åˆ†é’Ÿ** â†’ **30 ç§’**
- æ–°äººä¸Šæ‰‹æ—¶é—´ï¼šä» **2 å‘¨** â†’ **3 å¤©**
- ä»£ç ç†è§£å‡†ç¡®åº¦ï¼šæå‡ **60%**

**æˆæœ¬èŠ‚çœ**ï¼ˆ50 äººå›¢é˜Ÿï¼Œå¹´åŒ–ï¼‰ï¼š
```

èŠ‚çœæ—¶é—´ = 1.5 å°æ—¶/å¤© Ã— 50 äºº Ã— 250 å·¥ä½œæ—¥ = 18,750 å°æ—¶
æŒ‰æ—¶è–ª $80 è®¡ç®— = $1,500,000

```

---

## ä¸‰ã€åœºæ™¯äºŒï¼šä¸“å± SRE å·¥ç¨‹å¸ˆ

### 3.1 ä¸šåŠ¡ç—›ç‚¹

**å…¸å‹åœºæ™¯**ï¼š
```

å‡Œæ™¨ 2:00ï¼Œç”Ÿäº§ç¯å¢ƒå‘Šè­¦ï¼š

ğŸ“± PagerDuty: API å»¶è¿Ÿ P99 > 2s

SRE å·¥ç¨‹å¸ˆç¡çœ¼æƒºå¿ªåœ°çˆ¬èµ·æ¥ï¼š

1. ç™»å½• Grafana â†’ æŸ¥çœ‹å»¶è¿Ÿè¶‹åŠ¿å›¾
2. ç™»å½• Kibana â†’ æœç´¢é”™è¯¯æ—¥å¿—
3. ç™»å½• Datadog â†’ æ£€æŸ¥æœåŠ¡ä¾èµ–
4. ç™»å½• K8s Dashboard â†’ æŸ¥çœ‹ Pod çŠ¶æ€
5. ç™»å½• Sentry â†’ æŸ¥çœ‹å¼‚å¸¸å †æ ˆ

[20 åˆ†é’Ÿå...]
SRE: åŸæ¥æ˜¯æ•°æ®åº“è¿æ¥æ± æ»¡äº†...è¿™ 20 åˆ†é’Ÿèƒ½å¤šç¡ä¸€ä¼šå„¿ ğŸ˜´

````

**æ•°æ®ç»Ÿè®¡**ï¼š
- æ•…éšœå®šä½å¹³å‡è€—æ—¶ï¼š**25 åˆ†é’Ÿ**
- å·¥å…·åˆ‡æ¢æ¬¡æ•°ï¼šå¹³å‡ **6 æ¬¡**
- è¯¯åˆ¤ç‡ï¼š**15%**ï¼ˆå› ä¿¡æ¯ä¸å…¨ï¼‰

### 3.2 æ’ä»¶è§£å†³æ–¹æ¡ˆ

#### é›†æˆæ¶æ„

```mermaid
graph TB
    A[Claude Code] --> B[monitoring_plugin]

    B --> C[Prometheus]
    B --> D[Elasticsearch/Kibana]
    B --> E[Kubernetes API]
    B --> F[Datadog/Sentry]

    C --> G[æŒ‡æ ‡æŸ¥è¯¢]
    D --> H[æ—¥å¿—æœç´¢]
    E --> I[é›†ç¾¤çŠ¶æ€]
    F --> J[å¼‚å¸¸è¿½è¸ª]

    G --> K[ç»¼åˆåˆ†æå¼•æ“]
    H --> K
    I --> K
    J --> K

    K --> L[æ ¹å› è¯Šæ–­æŠ¥å‘Š]
    L --> A

    style B fill:#e1f5ff
    style K fill:#fff3e0
    style L fill:#c8e6c9
````

#### MCP Server å®ç°

**Prometheus ç›‘æ§æœåŠ¡å™¨**ï¼š

```json
{
  "mcpServers": {
    "prometheus": {
      "command": "python",
      "args": ["${CLAUDE_PLUGIN_ROOT}/servers/prometheus_server.py"],
      "env": {
        "PROMETHEUS_URL": "${PROMETHEUS_URL}",
        "READ_ONLY": "true"
      }
    }
  }
}
```

**æœåŠ¡å™¨æ ¸å¿ƒä»£ç **ï¼ˆprometheus_server.pyï¼‰ï¼š

```python
#!/usr/bin/env python3
"""
Prometheus MCP Server for Claude Code
Provides safe, read-only access to metrics
"""

import os
import requests
from datetime import datetime, timedelta
from typing import Dict, List, Optional

PROMETHEUS_URL = os.getenv('PROMETHEUS_URL', 'http://prometheus.internal:9090')

class PrometheusServer:
    def query(self, query: str, time: Optional[str] = None) -> Dict:
        """
        Execute PromQL query

        Args:
            query: PromQL expression
            time: RFC3339 timestamp (default: now)

        Returns:
            Query result with metric data
        """
        params = {'query': query}
        if time:
            params['time'] = time

        response = requests.get(
            f"{PROMETHEUS_URL}/api/v1/query",
            params=params,
            timeout=10
        )

        response.raise_for_status()
        return response.json()

    def query_range(
        self,
        query: str,
        start: str,
        end: str,
        step: str = '1m'
    ) -> Dict:
        """
        Execute range query for time series data

        Args:
            query: PromQL expression
            start: Start timestamp
            end: End timestamp
            step: Query resolution (e.g., '1m', '5m')

        Returns:
            Time series data
        """
        response = requests.get(
            f"{PROMETHEUS_URL}/api/v1/query_range",
            params={
                'query': query,
                'start': start,
                'end': end,
                'step': step
            },
            timeout=30
        )

        response.raise_for_status()
        return response.json()

    def get_p99_latency(
        self,
        service: str,
        duration: str = '15m'
    ) -> float:
        """Get P99 latency for a service"""
        query = f'''
        histogram_quantile(0.99,
          rate(http_request_duration_seconds_bucket{{
            service="{service}"
          }}[{duration}])
        )
        '''

        result = self.query(query)

        if result['data']['result']:
            return float(result['data']['result'][0]['value'][1])
        return 0.0

    def compare_with_baseline(
        self,
        service: str,
        metric: str,
        current_duration: str = '15m',
        baseline_offset: str = '7d'
    ) -> Dict:
        """Compare current metric with baseline (e.g., last week)"""
        # Current value
        current = self.query(
            f'{metric}{{service="{service}"}}'
        )

        # Baseline value (offset in the past)
        baseline_time = (
            datetime.now() - timedelta(days=7)
        ).isoformat() + 'Z'

        baseline = self.query(
            f'{metric}{{service="{service}"}}',
            time=baseline_time
        )

        current_val = float(current['data']['result'][0]['value'][1])
        baseline_val = float(baseline['data']['result'][0]['value'][1])

        change_pct = ((current_val - baseline_val) / baseline_val) * 100

        return {
            'current': current_val,
            'baseline': baseline_val,
            'change_percent': round(change_pct, 2),
            'trend': 'up' if change_pct > 0 else 'down'
        }

# MCP Server entry point
if __name__ == '__main__':
    server = PrometheusServer()
    # MCP protocol handling...
```

### 3.3 å®é™…ä½¿ç”¨ç¤ºä¾‹

**ç¤ºä¾‹ 1ï¼šå¿«é€Ÿæ€§èƒ½è¯Šæ–­**

```
ğŸ‘¤ User: "API ç½‘å…³æœ€è¿‘ 15 åˆ†é’Ÿçš„ P99 å»¶è¿Ÿæ˜¯å¤šå°‘ï¼Ÿå’Œä¸Šå‘¨åŒæœŸå¯¹æ¯”å¦‚ä½•ï¼Ÿ"

ğŸ¤– Claude Code:
[è°ƒç”¨ prometheus MCP server]

ğŸ“Š **API ç½‘å…³æ€§èƒ½åˆ†æ**

**å½“å‰çŠ¶æ€ï¼ˆæœ€è¿‘ 15 åˆ†é’Ÿï¼‰**
- P99 å»¶è¿Ÿ: 1,245 ms
- P95 å»¶è¿Ÿ: 892 ms
- P50 å»¶è¿Ÿ: 234 ms
- è¯·æ±‚é‡: 45,234 req/min

**ä¸Šå‘¨åŒæœŸå¯¹æ¯”**
- ä¸Šå‘¨ P99: 456 ms
- å˜åŒ–: +173% âš ï¸  **æ˜¾è‘—ä¸Šå‡**

**è¶‹åŠ¿åˆ†æ**
[ASCII å›¾è¡¨]
1400ms â”‚                              â•­â”€â•®
1200ms â”‚                         â•­â”€â”€â”€â”€â•¯ â•°â•®
1000ms â”‚                    â•­â”€â”€â”€â”€â•¯       â”‚
 800ms â”‚               â•­â”€â”€â”€â”€â•¯            â”‚
 600ms â”‚          â•­â”€â”€â”€â”€â•¯                 â”‚
 400ms â”‚â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯                      â”‚
       â””â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€
        10/9  10/10  ä»Šå¤©

**å¼‚å¸¸æ£€æµ‹**
ğŸ”´ Critical: å»¶è¿Ÿè¶…è¿‡ SLA é˜ˆå€¼ (1000ms)
âš ï¸  Warning: è¯·æ±‚é‡å¢é•¿ 23%ï¼Œä½†å®¹é‡æœªæ‰©å±•

**å»ºè®®æ“ä½œ**
1. æ£€æŸ¥æ…¢æŸ¥è¯¢ï¼š/query-logs "duration > 500ms"
2. æŸ¥çœ‹ä¸Šæ¸¸æœåŠ¡ï¼š/check-dependencies api-gateway
3. åˆ†æèµ„æºä½¿ç”¨ï¼š/k8s-status api-gateway
```

**ç¤ºä¾‹ 2ï¼šç»¼åˆæ•…éšœè¯Šæ–­**

```
ğŸ‘¤ User: "payment-service åˆšæ‰å‡ºç°å¤§é‡ 500 é”™è¯¯ï¼Œå¸®æˆ‘å®šä½é—®é¢˜"

ğŸ¤– Claude Code:
[å¤šç³»ç»Ÿè”åˆæŸ¥è¯¢]

ğŸ” **æ•…éšœè¯Šæ–­æŠ¥å‘Šï¼špayment-service**

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

## 1. é”™è¯¯æ¦‚å†µ

[Prometheus] é”™è¯¯ç‡ç»Ÿè®¡
- æ—¶é—´æ®µ: 14:25 - 14:32 (7 åˆ†é’Ÿ)
- æ€»è¯·æ±‚: 3,421
- é”™è¯¯æ•°: 1,876 (54.8%)
- é”™è¯¯ç±»å‹: HTTP 500, 503

## 2. æœåŠ¡çŠ¶æ€

[Kubernetes] Pod çŠ¶æ€
```

NAME STATUS RESTARTS
payment-service-7d9f8-x4k2j Running 12
payment-service-7d9f8-p8m1q Running 8
payment-service-7d9f8-n3h5s CrashLoopBackOff â† âš ï¸
payment-service-7d9f8-m2k9t Running 0
payment-service-7d9f8-l5p3q Running 0

```

ğŸ”´ **å‘ç°å¼‚å¸¸**ï¼š1/5 Pod å¤„äº CrashLoopBackOff

## 3. é”™è¯¯æ—¥å¿—

[Elasticsearch] æœ€è¿‘é”™è¯¯ (Top 3)
```

[ERROR] 14:28:45 - Database connection timeout after 5000ms
at ConnectionPool.acquire (pool.js:145)
at PaymentService.processPayment (service.js:78)
Occurrences: 1,234

[ERROR] 14:29:12 - Redis connection refused ECONNREFUSED
at RedisClient.connect (redis.js:92)
Occurrences: 542

[ERROR] 14:30:01 - Memory limit exceeded: 512MB/512MB
at process.<anonymous>
Occurrences: 100

````

## 4. æ ¹å› åˆ†æ

ğŸ¯ **ä¸»è¦åŸå› **ï¼šæ•°æ®åº“è¿æ¥æ± è€—å°½
   - å½“å‰è¿æ¥æ•°: 100/100 (æ»¡)
   - ç­‰å¾…é˜Ÿåˆ—: 234 ä¸ªè¯·æ±‚

ğŸ¯ **æ¬¡è¦åŸå› **ï¼šå†…å­˜æ³„æ¼å¯¼è‡´éƒ¨åˆ† Pod OOMKilled
   - Pod n3h5s å†…å­˜ä½¿ç”¨: 512MB (limit reached)
   - é‡å¯ 12 æ¬¡åè¿›å…¥ CrashLoop

## 5. å»ºè®®ä¿®å¤

**ç«‹å³è¡ŒåŠ¨**ï¼ˆæ¢å¤æœåŠ¡ï¼‰ï¼š
1. ```bash
   kubectl scale deployment payment-service --replicas=8
````

ä¸´æ—¶æ‰©å®¹è‡³ 8 ä¸ª Podï¼Œåˆ†æ•£è´Ÿè½½

2. ```bash
   kubectl delete pod payment-service-7d9f8-n3h5s
   ```
   åˆ é™¤å¼‚å¸¸ Podï¼Œè§¦å‘é‡å»º

**çŸ­æœŸä¿®å¤**ï¼ˆ1-2 å¤©ï¼‰ï¼š

- å¢åŠ æ•°æ®åº“è¿æ¥æ± ï¼š50 â†’ 150
- æå‡ Pod å†…å­˜é™åˆ¶ï¼š512MB â†’ 1GB
- æ·»åŠ è¿æ¥é‡è¯•é€»è¾‘

**é•¿æœŸä¼˜åŒ–**ï¼ˆ1-2 å‘¨ï¼‰ï¼š

- æ’æŸ¥å†…å­˜æ³„æ¼ç‚¹ï¼ˆå¯èƒ½åœ¨è®¢å•å¤„ç†é€»è¾‘ï¼‰
- å®ç°æ•°æ®åº“è¿æ¥æ± ç›‘æ§å‘Šè­¦
- ä¼˜åŒ–æ…¢æŸ¥è¯¢ï¼ˆpayment_transactions è¡¨ï¼‰

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â± **è¯Šæ–­è€—æ—¶**: 45 ç§’
ğŸ’¡ **ä¸‹ä¸€æ­¥**: éœ€è¦æˆ‘å¸®ä½ æ‰§è¡Œä¿®å¤å‘½ä»¤å—ï¼Ÿ

````

### 3.4 å®‰å…¨è®¾è®¡

**åªè¯»æƒé™æ§åˆ¶**ï¼š

```python
class SafePrometheusServer:
    # ç™½åå•ï¼šä»…å…è®¸æŸ¥è¯¢æ“ä½œ
    ALLOWED_ENDPOINTS = [
        '/api/v1/query',
        '/api/v1/query_range',
        '/api/v1/series',
        '/api/v1/labels'
    ]

    # é»‘åå•ï¼šç¦æ­¢ç®¡ç†æ“ä½œ
    FORBIDDEN_PATTERNS = [
        '/api/v1/admin',
        '/api/v1/targets',
        'DELETE',
        'PUT',
        'POST'
    ]

    def is_safe_request(self, endpoint: str, method: str) -> bool:
        """éªŒè¯è¯·æ±‚å®‰å…¨æ€§"""
        if method != 'GET':
            return False

        if endpoint not in self.ALLOWED_ENDPOINTS:
            return False

        return True
````

### 3.5 ä»·å€¼é‡åŒ–

**æ•ˆç‡æå‡**ï¼š

- æ•…éšœå®šä½æ—¶é—´ï¼šä» **25 åˆ†é’Ÿ** â†’ **2 åˆ†é’Ÿ**ï¼ˆå‡å°‘ 92%ï¼‰
- è¯¯åˆ¤ç‡ï¼šä» **15%** â†’ **3%**
- MTTR (Mean Time To Resolution)ï¼šä» **45 åˆ†é’Ÿ** â†’ **15 åˆ†é’Ÿ**

**ä¸šåŠ¡å½±å“**ï¼š

```
å‡è®¾æœˆå‡æ•…éšœ 20 æ¬¡ï¼š
èŠ‚çœæ—¶é—´ = (25min - 2min) Ã— 20 = 460 åˆ†é’Ÿ/æœˆ â‰ˆ 7.7 å°æ—¶
å‡å°‘åœæœºæ—¶é—´ = (45min - 15min) Ã— 20 = 600 åˆ†é’Ÿ â‰ˆ 10 å°æ—¶

æŒ‰ç³»ç»Ÿæ¯å°æ—¶è¥æ”¶ $10,000 è®¡ç®—ï¼š
é¿å…æŸå¤± = 10 hours Ã— $10,000 = $100,000/æœˆ
```

---

## å››ã€åœºæ™¯ä¸‰ï¼šæ— ç¼çš„é¡¹ç›®ç®¡ç†åä½œ

### 4.1 ä¸šåŠ¡ç—›ç‚¹

**å…¸å‹åœºæ™¯**ï¼š

```
äº§å“ç»ç†: "èƒ½ä¸èƒ½æŠŠæˆ‘ä»¬åˆšè®¨è®ºçš„æ–°åŠŸèƒ½åˆ›å»ºæˆ JIRA ticketï¼Ÿ"
å¼€å‘è€…: "å¥½çš„"

[å¼€å‘è€…çš„å®é™…æ“ä½œ]ï¼š
1. æ‰“å¼€ JIRA
2. ç‚¹å‡»"åˆ›å»º Issue"
3. å¡«å†™æ ‡é¢˜ã€æè¿°
4. é€‰æ‹© Epicã€Sprintã€ä¼˜å…ˆçº§
5. æŒ‡æ´¾ç»™è‡ªå·±
6. æ·»åŠ æ ‡ç­¾
7. é“¾æ¥ç›¸å…³æ–‡æ¡£
8. ä¿å­˜
9. å¤åˆ¶ ticket é“¾æ¥
10. å›åˆ° Slack ç²˜è´´é“¾æ¥

[5 åˆ†é’Ÿå...]
å¼€å‘è€…: è¿™ä¹ˆç®€å•çš„äº‹ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå¤šæ­¥éª¤ ğŸ˜¤
```

**ç»Ÿè®¡æ•°æ®**ï¼š

- åˆ›å»ºä¸€ä¸ª JIRA ticket å¹³å‡è€—æ—¶ï¼š**4.5 åˆ†é’Ÿ**
- æ¯äººæ¯å¤©åˆ›å»º/æ›´æ–°ï¼š**3-5 ä¸ª tickets**
- è·¨å·¥å…·å¤åˆ¶ç²˜è´´ï¼š**12+ æ¬¡/å¤©**

### 4.2 æ’ä»¶è§£å†³æ–¹æ¡ˆ

#### å·¥ä½œæµç¼–æ’

```mermaid
sequenceDiagram
    participant U as User
    participant C as Claude
    participant J as JIRA Plugin
    participant Co as Confluence Plugin
    participant S as Slack Plugin

    U->>C: "æŠŠè®¨è®ºå†…å®¹åˆ›å»ºæˆ JIRA story<br/>é“¾æ¥æŠ€æœ¯æ–‡æ¡£ï¼Œé€šçŸ¥å›¢é˜Ÿ"

    C->>C: 1. æ€»ç»“å¯¹è¯è¦ç‚¹

    C->>Co: 2. æœç´¢ç›¸å…³æ–‡æ¡£
    Co-->>C: æ–‡æ¡£ URL

    C->>J: 3. åˆ›å»º JIRA Story
    Note over J: æ ‡é¢˜: å¯¹è¯æ‘˜è¦<br/>æè¿°: è¯¦ç»†å†…å®¹<br/>é“¾æ¥: Confluence æ–‡æ¡£
    J-->>C: Story Key: PROJ-456

    C->>S: 4. å‘é€ Slack é€šçŸ¥
    Note over S: é¢‘é“: #dev-team<br/>å†…å®¹: æ–° Story åˆ›å»º<br/>é“¾æ¥: JIRA-456
    S-->>C: Message ID

    C->>U: âœ… ä»»åŠ¡å®Œæˆ<br/>JIRA: PROJ-456<br/>é€šçŸ¥å·²å‘é€
```

#### å‘½ä»¤å®šä¹‰

````markdown
---
name: create-story
description: Create JIRA story from discussion and notify team
---

# Create JIRA Story Workflow

When user asks to create a story/ticket, follow this workflow:

## Step 1: Summarize Discussion

Extract key information from recent conversation:

- **Title**: Concise feature description (< 80 chars)
- **Description**: Detailed requirements and context
- **Acceptance Criteria**: What defines "done"
- **Technical Notes**: Implementation hints or concerns

## Step 2: Search Related Documentation

Query Confluence for related docs:

```bash
curl "https://confluence.company.com/api/search?cql=text~<keywords>"
```
````

If found, note the document URLs for linking.

## Step 3: Create JIRA Issue

Call JIRA API:

```json
POST /rest/api/3/issue
{
  "fields": {
    "project": {"key": "PROJ"},
    "issuetype": {"name": "Story"},
    "summary": "<title>",
    "description": {
      "type": "doc",
      "version": 1,
      "content": [
        {
          "type": "paragraph",
          "content": [{"type": "text", "text": "<description>"}]
        }
      ]
    },
    "customfield_10010": "<epic-link>",
    "labels": ["ai-generated", "feature"]
  }
}
```

Capture the created issue key (e.g., PROJ-456).

## Step 4: Link Documentation

Add Confluence links to JIRA issue:

```json
POST /rest/api/3/issue/{issueKey}/remotelink
{
  "object": {
    "url": "<confluence-url>",
    "title": "Technical Design Doc"
  }
}
```

## Step 5: Notify Team

Send Slack message to #dev-team:

```json
POST https://slack.com/api/chat.postMessage
{
  "channel": "dev-team",
  "text": "New Story Created",
  "blocks": [
    {
      "type": "section",
      "text": {
        "type": "mrkdwn",
        "text": "*New Story*: <jira-url|PROJ-456>\n<summary>"
      }
    }
  ]
}
```

## Final Output

Provide summary:

```
âœ… Story created successfully

ğŸ“‹ JIRA: <jira-link>
   Title: <summary>
   Status: To Do
   Epic: <epic-name>

ğŸ“š Linked documents:
   - Technical Design: <conf-link>
   - API Spec: <conf-
```
