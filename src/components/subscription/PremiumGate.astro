---
/**
 * PremiumGate Component
 *
 * Displays a paywall/upgrade prompt when content requires a higher subscription tier.
 * Used to gate premium articles, cheatsheet downloads, and exclusive content.
 */
import { Icon } from 'astro-icon/components';
import Button from '~/components/ui/Button.astro';
import { t, getCurrentLanguage } from '~/i18n';

interface Props {
  /** Minimum tier required to access this content */
  requiredTier: 'standard' | 'premium';
  /** Type of content being gated (for messaging) */
  contentType?: 'article' | 'download' | 'api' | 'exclusive';
  /** Optional custom title */
  title?: string;
  /** Optional custom description */
  description?: string;
  /** Show a preview/teaser of the content */
  showPreview?: boolean;
}

const { requiredTier, contentType = 'article', title, description, showPreview = false } = Astro.props;

const lang = getCurrentLanguage();

// Default messages based on content type
const defaultMessages: Record<string, { title: string; description: string }> = {
  article: {
    title: t('subscription.gate.articleTitle', lang),
    description: t('subscription.gate.articleDescription', lang),
  },
  download: {
    title: t('subscription.gate.downloadTitle', lang),
    description: t('subscription.gate.downloadDescription', lang),
  },
  api: {
    title: t('subscription.gate.apiTitle', lang),
    description: t('subscription.gate.apiDescription', lang),
  },
  exclusive: {
    title: t('subscription.gate.exclusiveTitle', lang),
    description: t('subscription.gate.exclusiveDescription', lang),
  },
};

const displayTitle = title || defaultMessages[contentType]?.title || 'Premium Content';
const displayDescription =
  description || defaultMessages[contentType]?.description || 'Upgrade to access this content.';

const tierName = requiredTier === 'premium' ? 'Premium' : 'Standard';
const ctaText =
  requiredTier === 'premium' ? t('pages.pricing.cta.goPremium', lang) : t('pages.pricing.cta.subscribe', lang);
---

<div class="premium-gate relative">
  {
    showPreview && (
      <div class="preview-overlay absolute inset-0 bg-gradient-to-b from-transparent via-white/80 to-white dark:via-slate-900/80 dark:to-slate-900 z-10">
        <slot name="preview" />
      </div>
    )
  }

  <div
    class="gate-content bg-gradient-to-br from-primary/5 to-primary/10 dark:from-primary/10 dark:to-primary/20 border border-primary/20 rounded-xl p-8 text-center"
  >
    <div class="mb-4">
      <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary/10 dark:bg-primary/20">
        <Icon name="tabler:lock" class="w-8 h-8 text-primary" />
      </div>
    </div>

    <h3 class="text-xl font-bold mb-2 text-gray-900 dark:text-white">
      {displayTitle}
    </h3>

    <p class="text-gray-600 dark:text-gray-400 mb-6 max-w-md mx-auto">
      {displayDescription}
    </p>

    <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
      <Button variant="primary" href="/pricing" class="w-full sm:w-auto">
        <Icon name="tabler:sparkles" class="w-5 h-5 mr-2" />
        {ctaText}
      </Button>

      <Button variant="secondary" href="/auth/login" class="w-full sm:w-auto" data-i18n-key="auth.signIn">
        {t('auth.signIn', lang)}
      </Button>
    </div>

    <p class="mt-4 text-sm text-gray-500 dark:text-gray-500">
      {t('subscription.gate.tierRequired', lang).replace('{tier}', tierName)}
    </p>
  </div>
</div>

<style>
  .premium-gate {
    margin: 2rem 0;
  }

  .preview-overlay {
    pointer-events: none;
  }

  .gate-content {
    position: relative;
    z-index: 20;
  }
</style>
