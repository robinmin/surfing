---
/**
 * LoginPopupMenu Component
 * Compact popup menu with login provider options
 * Displays above the avatar button with provider icons + text
 */
import { Icon } from 'astro-icon/components';
import { getEnabledAuthMethods } from '~/lib/config';
import { t, getCurrentLanguage, type SupportedLanguage } from '~/i18n';

export interface Props {
  className?: string;
}

const { className = '' } = Astro.props;
const { google, apple } = getEnabledAuthMethods();
const lang = (Astro.currentLocale || getCurrentLanguage()) as SupportedLanguage;
---

<div
  class:list={[
    'login-popup-menu absolute top-full mt-2 right-0',
    'bg-white dark:bg-gray-800',
    'border border-gray-200 dark:border-gray-700',
    'rounded-xl shadow-2xl',
    'min-w-[280px] max-w-[320px]', // Increased width for better content fit
    'opacity-0 invisible',
    'transition-all duration-200 ease-in-out',
    'z-[60]', // Higher z-index to ensure it's above everything
    className,
  ]}
  data-popup-menu
>
  <div class="p-3">
    {
      google && (
        <button
          type="button"
          class="login-option-google w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all duration-150 rounded-lg border border-transparent hover:border-blue-200 dark:hover:border-blue-800 group"
          data-provider="google"
        >
          <div class="flex-shrink-0 w-10 h-10 flex items-center justify-center rounded-lg bg-blue-100 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700 group-hover:scale-105 transition-transform duration-150">
            <Icon name="tabler:brand-google" class="h-5 w-5 text-blue-600 dark:text-blue-400" />
          </div>
          <div class="flex-1">
            <div class="text-sm font-medium text-gray-900 dark:text-gray-100 group-hover:text-blue-700 dark:group-hover:text-blue-300 transition-colors duration-150">
              {t('auth.signInWithGoogle', lang)}
            </div>
          </div>
        </button>
      )
    }

    {
      apple && (
        <button
          type="button"
          class="login-option-apple w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-150 rounded-lg border border-transparent hover:border-gray-300 dark:hover:border-gray-600 group"
          data-provider="apple"
        >
          <div class="flex-shrink-0 w-10 h-10 flex items-center justify-center rounded-lg bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 group-hover:scale-105 transition-transform duration-150">
            <Icon name="tabler:brand-apple" class="h-5 w-5 text-gray-800 dark:text-gray-200" />
          </div>
          <div class="flex-1">
            <div class="text-sm font-medium text-gray-900 dark:text-gray-100 group-hover:text-gray-700 dark:group-hover:text-gray-300 transition-colors duration-150">
              {t('auth.signInWithApple', lang)}
            </div>
          </div>
        </button>
      )
    }
  </div>
</div>

<style>
  .login-popup-menu.show {
    opacity: 1;
    visibility: visible;
    transform: translateY(-4px); /* Add subtle upward animation */
  }

  /* Enhanced arrow pointing up to avatar */
  .login-popup-menu::before {
    content: '';
    position: absolute;
    top: -7px;
    right: 20px;
    width: 14px;
    height: 14px;
    background: inherit;
    border-right: 1px solid;
    border-bottom: 1px solid;
    border-color: inherit;
    transform: rotate(-45deg);
    z-index: -1;
  }

  /* Responsive adjustments */
  @media (max-width: 640px) {
    .login-popup-menu {
      right: 0;
      min-width: 260px;
      max-width: 300px;
    }

    .login-popup-menu::before {
      right: 16px;
    }
  }

  /* Prevent text overflow and ensure proper containment */
  .login-popup-menu {
    overflow-wrap: break-word;
    word-wrap: break-word;
    word-break: break-word;
    min-width: 280px;
    max-width: 320px;
    width: max-content;
    container-type: inline-size;
  }

  /* Ensure button text doesn't overflow */
  .login-option-google,
  .login-option-apple {
    width: 100%;
    min-width: 0;
    flex-shrink: 1;
  }

  .login-option-google .text-sm.font-medium,
  .login-option-apple .text-sm.font-medium {
    min-width: 0;
    flex-shrink: 1;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  /* Container query for responsive text sizing */
  @container (max-width: 300px) {
    .login-option-google .text-sm.font-medium,
    .login-option-apple .text-sm.font-medium {
      font-size: 0.875rem; /* Keep text size but ensure it fits */
    }
  }

  /* Button hover effects */
  .login-option-google:hover,
  .login-option-apple:hover {
    transform: translateX(2px);
  }

  /* Icon container effects */
  .login-option-google .icon-container,
  .login-option-apple .icon-container {
    transition: all 0.15s ease-in-out;
  }
</style>
