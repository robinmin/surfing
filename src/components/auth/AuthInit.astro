---
// Access environment variables in the frontmatter (server-side)
// Astro replaces import.meta.env at build time here
const config = {
  authority: import.meta.env.PUBLIC_ZITADEL_AUTHORITY,
  clientId: import.meta.env.PUBLIC_ZITADEL_CLIENT_ID,
  redirectUri: import.meta.env.PUBLIC_ZITADEL_REDIRECT_URI,
  postLogoutUri: import.meta.env.PUBLIC_ZITADEL_POST_LOGOUT_URI,
  orgId: import.meta.env.PUBLIC_ZITADEL_ORG_ID,
  idpGoogle: import.meta.env.PUBLIC_ZITADEL_IDP_GOOGLE,
  idpGithub: import.meta.env.PUBLIC_ZITADEL_IDP_GITHUB,
  idpApple: import.meta.env.PUBLIC_ZITADEL_IDP_APPLE,
  idpMicrosoft: import.meta.env.PUBLIC_ZITADEL_IDP_MICROSOFT,
};
---

<script define:vars={{ config }}>
  import { initOIDC } from "~/lib/turnstile-client";

  // Initialize OIDC client with config passed from server-side
  initOIDC({
    authority: config.authority,
    clientId: config.clientId,
    redirectUri:
      config.redirectUri || window.location.origin + "/auth/callback",
    postLogoutUri: config.postLogoutUri || window.location.origin,
    orgId: config.orgId,
    idpHints: {
      google: config.idpGoogle || "",
      github: config.idpGithub || "",
      apple: config.idpApple || "",
      microsoft: config.idpMicrosoft || "",
    },
  });

  console.log("âœ… OIDC Client initialized");
</script>
