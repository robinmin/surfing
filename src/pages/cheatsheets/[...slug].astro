---
import { getCollection, type CollectionEntry } from 'astro:content';

import ExternalPageLayout from '~/layouts/ExternalPageLayout.astro';

export async function getStaticPaths() {
  const cheatsheets = await getCollection('cheatsheets', ({ data }) => !data.draft);

  return cheatsheets.map((cheatsheet) => ({
    params: {
      slug: cheatsheet.data.slug || cheatsheet.id,
    },
    props: { cheatsheet },
  }));
}

interface Props {
  cheatsheet: CollectionEntry<'cheatsheets'>;
}

const { cheatsheet } = Astro.props;

// For cheatsheets, use raw body content since it's already HTML
// The body contains raw HTML that should not be processed as markdown
const renderedContent = cheatsheet.body;

// Merge custom metadata with defaults
const metadata = {
  title: cheatsheet.data.title,
  description: cheatsheet.data.description,
  canonical: `${Astro.site}cheatsheets/${cheatsheet.data.slug || cheatsheet.id}`,
  openGraph: {
    type: 'article',
  },
  ...cheatsheet.data.metadata,
};
---

<ExternalPageLayout metadata={metadata} entry={cheatsheet}>
  <div set:html={renderedContent} />
</ExternalPageLayout>
